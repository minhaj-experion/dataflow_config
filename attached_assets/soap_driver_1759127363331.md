# SoapStoreDriver

## Overview

The `SoapStoreDriver` class is a specialized data ingestion driver designed to extract data from SOAP-based web services. It supports various authentication methods, XML parsing, namespace handling, and pagination strategies (offset-based and page-based).

---

## Configuration Structure

```yaml
from:
  store:
    type: soap
    url: "https://example.com/service"
    extension: "svc"                  # optional, e.g., "svc", "asmx", etc.
    is_wsdl: false                    # true if WSDL should be fetched (appends ?wsdl)
    authentication_type: "basic"     # one of: none, basic, bearer, api_key, oauth2, custom
    authentication:
      username: "user"               # for basic
      password: "pass"
      token: "abc123"                # for bearer
      key_name: "api_key"           # for api_key
      key_value: "value"
      location: "header"            # header | query | body
      client_id: "your_client_id"   # for oauth2
      client_secret: "your_client_secret"
      token_url: "https://auth.example.com/token"
      headers:                      # for custom
        X-Custom-Header: "value"
    soap_config:
      body: "<soapenv:Envelope>...</soapenv:Envelope>"
      headers:
        - name: "Content-Type"
          value: "text/xml; charset=utf-8"
    data_path: "Item"                # tag name to extract from response
    namespace: "http://schemas.xmlsoap.org/..."  # optional XML namespace
    selected_columns:               # optional; map internal XML tags to your column names
      name: "Name"
      id: "Identifier"
    pagination:
      enabled: true
      type: offset | page
      offset: 0                    # starting offset (for offset pagination)
      limit: 100
      total_count: 1000           # optional
      offset_param: "Offset"      # optional, defaults to "offset"
      limit_param: "Limit"
      start_page: 1               # for page-based pagination
      page_param: "Page"
      total_pages: 10            # optional
```

---

## Parameters

| Argument               | Type         | Mandatory | Default Value | Description |
|------------------------|--------------|-----------|----------------|-------------|
| `url`                  | `str`        | Yes       | —              | SOAP endpoint base URL. |
| `extension`            | `str`        | No        | `None`         | Optional extension to append to the endpoint (e.g., `svc`, `asmx`). |
| `is_wsdl`              | `bool`       | No        | `False`        | Whether to append `?wsdl` to the URL. |
| `soap_config.body`     | `str`        | Yes       | —              | Full XML body for the SOAP request. |
| `soap_config.headers`  | `list[dict]` | Yes       | —              | HTTP headers for SOAP requests. |
| `data_path`            | `str`        | No        | `None`         | XML tag to extract as record (used in `.findall`). |
| `namespace`            | `str`        | No        | `None`         | Optional namespace URI used in tag parsing. |
| `selected_columns`     | `dict`       | No        | `None`         | Optional mapping of XML tags to friendly column names. |
| `authentication_type`  | `str`        | No        | `'none'`       | Authentication method (`none`, `basic`, `bearer`, `api_key`, `oauth2`, `custom`). |
| `authentication`       | `dict`       | No        | `None`         | Credential and token information for authentication. |
| `pagination`           | `dict`       | No        | `None`         | Optional pagination settings (see below). |


---

## Supported Pagination Types

### Offset-based Pagination

| Key              | Type   | Description |
|------------------|--------|-------------|
| `offset`         | int    | Starting offset value. |
| `limit`          | int    | Number of records per page. |
| `total_count`    | int    | Optional total number of records. |
| `offset_param`   | str    | Parameter name used in the query. |
| `limit_param`    | str    | Parameter name used in the query. |

### Page-based Pagination

| Key              | Type   | Description |
|------------------|--------|-------------|
| `start_page`     | int    | Starting page number. |
| `limit`          | int    | Number of records per page. |
| `total_pages`    | int    | Optional total number of pages. |
| `page_param`     | str    | Parameter name used in the query. |
| `limit_param`    | str    | Parameter name used in the query. |

---

## Authentication Methods

| Type        | Parameters Required |
|-------------|---------------------|
| `none`      | None |
| `basic`     | `username`, `password` |
| `bearer`    | `token` |
| `api_key`   | `key_name`, `key_value`, `location` (`header`, `query`, or `body`) |
| `oauth2`    | `client_id`, `client_secret`, `token_url` (auto-fetches token) |
| `custom`    | `headers` dictionary |

---

## Output

Returns one of the following:
- A `DataFrame` if records are found under the `data_path`.
- A dictionary `{ "data_df": <raw XML string> }` if no data is extracted or if `data_path` is not provided.

---

## Example Use Case

```yaml
from:
  store:
    type: soap
    url: "https://api.example.com/myservice"
    extension: "svc"
    is_wsdl: false
    authentication_type: "basic"
    authentication:
      username: "myuser"
      password: "mypass"
    soap_config:
      body: |
        <soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ns="http://example.com/">
          <soapenv:Header/>
          <soapenv:Body>
            <ns:GetItems/>
          </soapenv:Body>
        </soapenv:Envelope>
      headers:
        - name: "Content-Type"
          value: "text/xml;charset=UTF-8"
    data_path: "Item"
    namespace: "http://example.com/"
    selected_columns:
      ID: "id"
      Name: "name"
    pagination:
      enabled: true
      type: offset
      offset: 0
      limit: 50
      total_count: 150
```
